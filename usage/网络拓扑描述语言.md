# 网络拓扑描述语言

## Example
```
//定义机器的基础属性，描述出口网络状态
node {
	ip 172.0.0.1/24
	delay 100ms 10ms 30%
	loss 1% 30%
}

//定义机房或区域属性，以group或IP为单位，描述双向网络状态
group idc1 {
	ip 192.168.1.2
	ip 192.168.1.3
	ip 192.168.1.4
	delay 100ms 10ms 30%
	loss 1% 30%
}

group china {
	idc1 idc2 idc3
	ip 192.168.1.5
	delay 100ms 10ms 1%
	duplicate 1%
	rate 100mbit
}

//整个网络的唯一描述入口，以空行分开，以group为单位，描述双向网络状态
network {
	china europe
	delay 200ms 10ms 1%
	corrupt 0.2%
	rate 10mbit
	
	china japan
	delay 100ms 10ms 1%
	rate 10mbit
	
	japan korea taiwan
	delay 30ms 5ms 1%
	rate 100mbit
}

```

## JSON形式
```
{
    "node": [
        {
            "ip": "192.168.1.1/24",
            "delay": "100ms 10ms 30%",
            "loss": "1% 10%"
        },
        {
            "ip": "10.1.1.1/20",
            "delay": "100ms 10ms 30%",
            "loss": "1% 10%"
        }
    ],
    "group": [
        {
            "name": "idc1",
            "nodes": [
                "192.168.1.2",
                "192.168.1.3",
                "192.168.1.4"
            ],
            "delay": "100ms 10ms 30%",
            "loss": "1% 10%"
        },
        {
            "name": "china",
            "nodes": [
                "idc1",
                "idc2",
                "192.168.1.4"
            ],
            "delay": "100ms 10ms 30%",
            "duplicate": "1%",
            "rate": "100mbit"
        }
    ],
    "network": [
        {
            "groups": [
                "china",
                "europe"
            ],
            "delay": "200ms 10ms 1%",
            "corrupt": "0.2%",
            "rate": "10mbit"
        },
        {
            "groups": [
                "china",
                "japan"
            ],
            "delay": "100ms 10ms 1%",
            "rate": "10mbit"
        },
        {
            "groups": [
                "japan",
                "korea",
                "taiwan"
            ],
            "delay": "30ms 5ms 1%",
            "rate": "100mbit"
        }
    ]
}
```

## YAML形式
```
node:
 -
  ip: "192.168.1.1/24"
  delay: "100ms 10ms 30%"
  loss: "1% 10%"
 -
  ip: "10.1.1.1/20"
  delay: "100ms 10ms 30%"
  loss: "1% 10%"

group:
  idc1:
    nodes:
      - "192.168.1.2"
      - "192.168.1.3"
      - "192.168.1.4"
    delay: "100ms 10ms 30%"
    loss: "1% 10%"
  china:
    nodes:
      - "idc1"
      - "idc2"
      - "192.168.1.4"
    delay: "100ms 10ms 30%"
    duplicate: "1%"
    rate: "100mbit"

network:
 -
  groups:
      - china
      - europe
  delay: "200ms 10ms 1%"
  corrupt: "0.2%"
  rate: "10mbit"

 -
  groups:
      - china
      - japan
  delay: "100ms 10ms 1%"
  rate: "10mbit"

 -
  groups:
      - japan
      - korea
      - taiwan
  delay: "30ms 5ms 1%"
  rate: "100mbit"

```

## 关键词说明
### node
描述单机的基础属性，可以不写，表示机器无限制。规则只应用于出口(上行)

### group
描述单机组成的集群或区域，可以嵌套group

### network
整个网络的描述入口，写入这里的会最终翻译成TC规则

### ip
后面跟着机器IP，可以用CIDR描述多个机器

### delay
delay 100ms ,同时,大约有 30% 的包会延迟 ± 10ms 发送

### loss
丢包率，同TC参数

### duplicate
重复数据包概率，同TC参数

### rate
限速度参数，根据TC的定义，这块的限速不是精准限速，会在这个值浮动一些

## 规则冲突处理
同一个级别的网络，如node之间，group之间，以文件顺序最后写的为准。  
不同级别的网络为嵌套规则，叠加生效
